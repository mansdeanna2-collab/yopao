<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Loading‚Ä¶ ‚Äì Buy Discount Postage Online</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../css/common.css">
  <link rel="stylesheet" href="../css/product.css">
</head>
<body>

<!-- ========== Top Bar ========== -->
<div class="top-bar">
  <span class="top-bar-text">Free Shipping On All Orders. 3‚Äì8 Business Days Delivery</span>
  <span class="top-bar-search"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="7"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></span>
</div>

<!-- ========== Header ========== -->
<div class="header-wrapper" id="header">
  <header class="site-header">
    <button class="hamburger" id="hamburger-btn" aria-label="Menu">&#9776;</button>
    <div class="logo"><a href="../"><span class="logo-icon">S</span>stampstores</a></div>
    <nav class="nav-main">
      <a href="../">HOME</a>
      <a href="/category/#flag-series">FLAG SERIES</a>
      <a href="/category/#christmas-holiday">CHRISTMAS &amp; HOLIDAY</a>
      <a href="/category/#wedding-flowers">WEDDING &amp; FLOWERS</a>
      <a href="/category/#animal-series">ANIMAL SERIES</a>
      <a href="/category/#other-years">OTHER YEARS ‚ñæ</a>
      <a href="/contact-us/">CONTACT US</a>
    </nav>
    <div class="header-right">
      <a href="#" id="account-btn" class="header-icon account-icon" aria-label="Account"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 12c2.7 0 4.8-2.1 4.8-4.8S14.7 2.4 12 2.4 7.2 4.5 7.2 7.2 9.3 12 12 12zm0 2.4c-3.2 0-9.6 1.6-9.6 4.8v2.4h19.2v-2.4c0-3.2-6.4-4.8-9.6-4.8z"/></svg></a>
      <div class="cart-wrapper" id="cart-wrapper">
        <button class="cart-link" id="cart-toggle" aria-label="Cart">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>
            <span id="cart-total">$0.00</span>
            <span class="cart-divider"></span>
            <span class="cart-badge" id="cart-badge">0</span>
          </button>
        <div class="cart-dropdown" id="cart-dropdown">
          <div id="cart-items-list"></div>
          <div class="cart-subtotal" id="cart-subtotal-row" style="display:none">
            <span>Subtotal:</span>
            <span class="subtotal-amount" id="cart-subtotal-amount">$0.00</span>
          </div>
          <div class="cart-actions" id="cart-action-btns" style="display:none">
            <button class="cart-btn view-cart-btn">VIEW CART</button>
            <button class="cart-btn checkout-btn">CHECKOUT</button>
          </div>
        </div>
      </div>
    </div>
  </header>
</div>

<!-- ========== Mobile Nav ========== -->
<div class="mobile-nav-overlay" id="mobile-nav-overlay"></div>
<div class="mobile-nav-panel" id="mobile-nav-panel">
  <div class="close-btn" id="mobile-nav-close">&times;</div>
  <ul>
    <li><a href="../">HOME</a></li>
    <li><a href="/category/#flag-series">FLAG SERIES</a></li>
    <li><a href="/category/#christmas-holiday">CHRISTMAS &amp; HOLIDAY</a></li>
    <li><a href="/category/#wedding-flowers">WEDDING &amp; FLOWERS</a></li>
    <li><a href="/category/#animal-series">ANIMAL SERIES</a></li>
    <li><a href="/category/#other-years">OTHER YEARS</a></li>
    <li><a href="/contact-us/">CONTACT US</a></li>
  </ul>
</div>

<!-- ========== Page Content (dynamically rendered) ========== -->
<div id="product-page-content">
  <div class="skeleton-product-layout">
    <div class="skeleton-card skeleton-product-gallery"><div class="skeleton-img"></div></div>
    <div class="skeleton-product-info"><div class="skeleton-text skeleton-text-title"></div><div class="skeleton-text skeleton-text-price"></div><div class="skeleton-text"></div><div class="skeleton-text"></div><div class="skeleton-text short"></div><div class="skeleton-text skeleton-text-btn"></div></div>
  </div>
</div>

<!-- ========== Footer ========== -->
<footer>
  <div class="footer-content">
    <div class="footer-columns">
      <div class="footer-column">
        <h3>INFORMATION</h3>
        <div class="footer-divider"></div>
        <ul>
          <li><a href="/privacy-policy/">Privacy Policy</a></li>
          <li><a href="../shipping-policy/">Shipping Policy</a></li>
          <li><a href="../refund-return-policy/">Refund and Return Policy</a></li>
          <li><a href="../terms-of-service/">Terms of Service</a></li>
          <li><a href="#">Billings Terms and Condition</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h3>NEED HELP</h3>
        <div class="footer-divider"></div>
        <ul>
          <li><a href="#">About Us</a></li>
          <li><a href="#">Track Order</a></li>
          <li><a href="/contact-us/">Contact Us</a></li>
          <li><a href="#">FAQs</a></li>
        </ul>
      </div>
      <div class="footer-column">
        <h3>CONTACT</h3>
        <div class="footer-divider"></div>
        <div class="contact-info">
          <p><strong>EDDM LLC</strong></p>
          <p><strong>Email:</strong> support@eddm.shop</p>
          <p><strong>Phone:</strong> (970) 329-9777</p>
          <p><strong>Address:</strong> 3605 Avalon St, Philadelphia, PA 19114</p>
        </div>
      </div>
    </div>
  </div>
  <div class="footer-bottom">
    <div class="payment-icons">
      <span class="footer-pay-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" width="20" height="20"><circle cx="20" cy="20" r="20" fill="#26A17B"/><path d="M22.6 21.5v0c-.2 0-1 .1-2.6.1s-2.2-.1-2.5-.1c-5-.2-8.8-1.2-8.8-2.3s3.7-2.1 8.8-2.3v3.6c.4 0 1.1.1 2.6.1 1.7 0 2.3-.1 2.6-.1v-3.6c5 .2 8.8 1.2 8.8 2.3-.1 1.2-3.8 2.1-8.9 2.3zm0-5v-3.2h7.3v-4.8H10.2v4.8h7.3v3.2c-5.7.3-10 1.5-10 3s4.3 2.8 10 3v10.7h5v-10.7c5.7-.3 10-1.5 10-3s-4.3-2.8-10-3z" fill="#fff"/></svg>
        USDT TRC20
      </span>
      <span class="footer-pay-icon unavailable">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 28" width="20" height="24" aria-label="PayPal"><path fill="#003087" d="M19.5 7.8c.3-2 0-3.3-.9-4.6C17.4 1.7 15 .9 12 .9H4.4c-.5 0-1 .4-1.1.9L.6 19.6c-.1.3.2.6.5.6h3.6l.9-5.7v.2c.1-.5.6-.9 1.1-.9h2.2c4.4 0 7.8-1.8 8.8-6.9v-.5c-.1 0-.1 0 0 0 .3-1.7.3-2.8-.2-3.6z"/><path fill="#0070ba" d="M19.5 7.8c-.3 1.8-.9 3.3-2.2 4.4-1.5 1.3-3.5 1.9-6 1.9h-1.5c-.5 0-1 .4-1.1.9l-1.2 7.5c-.1.3.2.6.5.6h3.2c.5 0 .9-.3 1-.8l.7-4.6c.1-.5.5-.8 1-.8h.6c3.8 0 6.8-1.5 7.7-6 .3-1.5.2-2.8-.7-3.7-.3-.3-.6-.5-1-.6-.3.5-.6 1-.7 1.2 0 .1 0 .1-.3 0z"/></svg>
        PayPal
      </span>
    </div>
    <div class="copyright">Copyright 2026 &copy; <strong>eddm.shop</strong></div>
  </div>
</footer>

<!-- ========== Back to Top ========== -->
<button class="back-to-top" id="back-to-top" aria-label="Go to top">&#9650;</button>

<!-- ========== Login Modal ========== -->
<div id="login-modal-overlay">
  <div id="login-modal">
    <button id="login-modal-close" aria-label="Close">&times;</button>
    <h2>Login</h2>
    <form onsubmit="return false;">
      <input class="login-modal-input" type="text" id="login-username" placeholder="Username or Email" aria-label="Username or Email" autocomplete="username">
      <input class="login-modal-input" type="password" id="login-password" placeholder="Password" aria-label="Password" autocomplete="current-password">
      <label class="login-modal-remember"><input type="checkbox"> Remember me</label>
      <button class="login-modal-submit" type="submit">Log in</button>
    </form>
    <a href="#" class="login-modal-lost">Lost your password?</a>
    <hr class="login-modal-divider">
    <button class="login-modal-create" type="button">Create an account</button>
  </div>
</div>

<script src="../js/common.js"></script>
<script>
(function () {
  function ensureLocalImagePath(url) {
    if (!url) return '';
    var m = url.match(/https?:\/\/eddm\.shop\/wp-content\/uploads\/\d{4}\/\d{2}\/(.+)$/);
    if (m) return '/images/products/' + m[1];
    return url;
  }

  function ensureLocalProductImages(product) {
    if (product.img1) product.img1 = ensureLocalImagePath(product.img1);
    if (product.img2) product.img2 = ensureLocalImagePath(product.img2);
    if (product.images && product.images.length) {
      product.images = product.images.map(ensureLocalImagePath);
    }
    return product;
  }

  var CATEGORY_TO_SLUG = {
    'Flag Series': 'flag-series',
    'Christmas & Holiday': 'christmas-holiday',
    'Wedding & Flowers': 'wedding-flowers',
    'Animal Series': 'animal-series',
    'Other Years': 'other-years',
    '2 oz Letter': '2-oz-letter',
    'Global Series': 'global-series'
  };

  var DISCOUNT_TIERS = [
    { min: 3, max: 5, pct: 10 },
    { min: 6, max: 10, pct: 15 },
    { min: 11, max: 30, pct: 20 },
    { min: 31, max: 100, pct: 25 },
    { min: 101, max: Infinity, pct: 30 }
  ];

  function categorySlug(cat) {
    if (CATEGORY_TO_SLUG[cat]) return CATEGORY_TO_SLUG[cat];
    return cat.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
  }

  function escapeHTML(str) {
    var div = document.createElement('div');
    div.appendChild(document.createTextNode(str));
    return div.innerHTML;
  }

  function getBasePrice(priceStr) {
    return parseFloat(priceStr.replace(/[$,]/g, ''));
  }

  function fmt(n) { return '$' + n.toFixed(2); }

  function getDiscountPct(qty) {
    for (var i = 0; i < DISCOUNT_TIERS.length; i++) {
      if (qty >= DISCOUNT_TIERS[i].min && qty <= DISCOUNT_TIERS[i].max) return DISCOUNT_TIERS[i].pct;
    }
    return 0;
  }

  function buildDiscountTable(basePrice) {
    var html = '<thead><tr><th>QUANTITY</th><th>PRICE</th><th>DISCOUNT</th></tr></thead><tbody>';
    DISCOUNT_TIERS.forEach(function (t) {
      var label = t.max === Infinity ? t.min + '+' : t.min + '-' + t.max;
      var discounted = basePrice * (1 - t.pct / 100);
      html += '<tr><td>' + label + '</td><td>' + fmt(discounted) + '</td><td class="discount-pct">' + t.pct + '%</td></tr>';
    });
    html += '</tbody>';
    return html;
  }

  function buildBreadcrumb(product) {
    var cat = product.all_categories && product.all_categories[0] ? product.all_categories[0] : product.category;
    var slug = categorySlug(cat);
    return '<div class="breadcrumb-section"><div class="breadcrumb-inner"><div class="breadcrumb">' +
      '<a href="../">HOME</a><span class="divider">/</span>' +
      '<a href="/category/#' + slug + '">' + escapeHTML(cat).toUpperCase() + '</a><span class="divider">/</span>' +
      '<span class="current">' + escapeHTML(product.name) + '</span>' +
      '</div></div></div>';
  }

  function buildGallery(product) {
    var images = product.images && product.images.length ? product.images : [product.img1, product.img2].filter(Boolean);
    var thumbsHTML = '';
    images.forEach(function (url, i) {
      thumbsHTML += '<img class="gallery-thumb' + (i === 0 ? ' active' : '') + '" src="' + escapeHTML(url) + '" alt="' + escapeHTML(product.name) + ' view ' + (i + 1) + '" data-index="' + i + '">';
    });
    return '<div class="product-gallery">' +
      '<div class="gallery-main" id="gallery-main">' +
      '<img id="main-img" src="' + escapeHTML(images[0]) + '" alt="' + escapeHTML(product.name) + '">' +
      '<button class="gallery-arrow prev" id="gallery-prev" aria-label="Previous image">&#8249;</button>' +
      '<button class="gallery-arrow next" id="gallery-next" aria-label="Next image">&#8250;</button>' +
      '<button class="gallery-zoom" aria-label="Zoom image">&#128269;</button>' +
      '</div>' +
      '<div class="gallery-thumbs">' + thumbsHTML + '</div>' +
      '</div>';
  }

  function buildProductInfo(product) {
    var basePrice = getBasePrice(product.price);
    var stock = product.stock || 0;

    var categoriesHTML = '';
    var cats = product.all_categories && product.all_categories.length ? product.all_categories : [product.category];
    cats.forEach(function (c, i) {
      if (i > 0) categoriesHTML += ', ';
      categoriesHTML += '<a href="/category/#' + categorySlug(c) + '">' + escapeHTML(c) + '</a>';
    });

    return '<div class="product-info-col">' +
      '<h1 class="product-title">' + escapeHTML(product.name) + '</h1>' +
      '<div class="product-divider"></div>' +
      '<div class="product-price-main">' + escapeHTML(product.price) + '</div>' +
      '<div class="discount-label">Buy More, Pay Less! (1 style = 100 Pcs)</div>' +
      '<table class="discount-table">' + buildDiscountTable(basePrice) + '</table>' +
      '<div class="variation-row">' +
        '<div class="variation-label">Quantity : <span id="variation-selected">5 Sheets of 20 (100 Stamps)</span></div>' +
        '<div class="variation-btns">' +
          '<button class="variation-btn active" id="variation-btn-1">5 Sheets of 20 (100 Stamps)</button>' +
          '<button class="variation-clear" id="variation-clear">CLEAR</button>' +
        '</div>' +
      '</div>' +
      '<div class="selected-price-row">' +
        '<span class="selected-price" id="selected-price">' + escapeHTML(product.price) + '</span>' +
        '<span class="stock-status">' + stock + ' in stock</span>' +
      '</div>' +
      '<div class="qty-cart-row">' +
        '<div class="qty-stepper">' +
          '<button id="qty-minus" aria-label="Decrease quantity">&#8722;</button>' +
          '<input type="number" id="qty-input" value="1" min="1" max="' + stock + '" aria-label="Quantity">' +
          '<button id="qty-plus" aria-label="Increase quantity">+</button>' +
        '</div>' +
        '<button class="add-to-cart-main" id="add-to-cart-btn">ADD TO CART</button>' +
      '</div>' +
      '<div class="product-meta">' +
        '<div>SKU: <span>' + escapeHTML(product.sku || '') + '</span></div>' +
        '<div>Categories: ' + categoriesHTML + '</div>' +
      '</div>' +
      '<div class="social-share">' +
        '<a href="#" class="social-btn" aria-label="Share on Facebook" title="Facebook">f</a>' +
        '<a href="#" class="social-btn" aria-label="Share on Twitter" title="Twitter">ùïè</a>' +
        '<a href="#" class="social-btn" aria-label="Share via Email" title="Email">‚úâ</a>' +
        '<a href="#" class="social-btn" aria-label="Share on Pinterest" title="Pinterest">ùêè</a>' +
        '<a href="#" class="social-btn" aria-label="Share on LinkedIn" title="LinkedIn">in</a>' +
      '</div>' +
      '</div>';
  }

  function buildDescriptionTab(product) {
    var desc = product.description || '';
    var paragraphs = desc.split(/\n+/).filter(Boolean);
    var html = '';
    paragraphs.forEach(function (p) {
      html += '<p>' + escapeHTML(p) + '</p>';
    });
    return '<div class="product-tabs-section">' +
      '<div class="tab-buttons"><button class="tab-btn active" data-tab="description">DESCRIPTION</button></div>' +
      '<div class="tab-panel active" id="tab-description">' + html + '</div>' +
      '</div>';
  }

  function buildRelatedProducts(product, allProducts) {
    var cats = product.all_categories && product.all_categories.length ? product.all_categories : [product.category];
    var related = allProducts.filter(function (p) {
      if (p.slug === product.slug) return false;
      var pCats = p.all_categories && p.all_categories.length ? p.all_categories : [p.category];
      for (var i = 0; i < cats.length; i++) {
        if (pCats.indexOf(cats[i]) !== -1) return true;
      }
      return false;
    });

    // Shuffle and pick 5
    for (var i = related.length - 1; i > 0; i--) {
      var j = Math.floor(Math.random() * (i + 1));
      var tmp = related[i]; related[i] = related[j]; related[j] = tmp;
    }
    related = related.slice(0, 5);

    if (related.length === 0) return '';

    var cardsHTML = '';
    related.forEach(function (p) {
      var displayCat = p.all_categories && p.all_categories.length ? p.all_categories[0] : p.category;
      cardsHTML += '<div class="product-card">' +
        '<a href="/product/#' + encodeURIComponent(p.slug) + '">' +
          '<div class="product-image"><img src="' + escapeHTML(p.img1 || (p.images && p.images[0]) || '') + '" alt="' + escapeHTML(p.name) + '" loading="lazy"></div>' +
          '<div class="product-info">' +
            '<p class="product-category">' + escapeHTML(displayCat) + '</p>' +
            '<p class="product-name">' + escapeHTML(p.name) + '</p>' +
            '<p class="product-price">' + escapeHTML(p.price) + '</p>' +
          '</div>' +
        '</a></div>';
    });

    return '<div class="related-section"><h2 class="related-title">Related Products</h2>' +
      '<div class="related-grid">' + cardsHTML + '</div></div>';
  }

  function renderProduct(product, allProducts) {
    document.title = product.name + ' ‚Äì Buy Discount Postage Online';
    var container = document.getElementById('product-page-content');

    container.innerHTML =
      buildBreadcrumb(product) +
      '<div class="product-section"><div class="product-layout">' +
        buildGallery(product) +
        buildProductInfo(product) +
      '</div></div>' +
      buildDescriptionTab(product) +
      buildRelatedProducts(product, allProducts);

    initInteractions(product);
  }

  function initInteractions(product) {
    var images = product.images && product.images.length ? product.images : [product.img1, product.img2].filter(Boolean);
    var currentIdx = 0;
    var mainImg = document.getElementById('main-img');
    var thumbs = document.querySelectorAll('.gallery-thumb');
    var basePrice = getBasePrice(product.price);

    function showImage(idx) {
      currentIdx = (idx + images.length) % images.length;
      mainImg.src = images[currentIdx];
      thumbs.forEach(function (t, i) {
        t.classList.toggle('active', i === currentIdx);
      });
    }

    thumbs.forEach(function (thumb) {
      thumb.addEventListener('click', function () {
        showImage(parseInt(this.getAttribute('data-index'), 10));
      });
    });

    document.getElementById('gallery-prev').addEventListener('click', function () { showImage(currentIdx - 1); });
    document.getElementById('gallery-next').addEventListener('click', function () { showImage(currentIdx + 1); });

    // Touch swipe support for mobile gallery
    var galleryMain = document.getElementById('gallery-main');
    var touchStartX = 0;
    galleryMain.addEventListener('touchstart', function (e) {
      touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });
    galleryMain.addEventListener('touchend', function (e) {
      var diff = e.changedTouches[0].screenX - touchStartX;
      if (Math.abs(diff) > 50) {
        if (diff < 0) { showImage(currentIdx + 1); }
        else { showImage(currentIdx - 1); }
      }
    }, { passive: true });

    // Quantity stepper
    var qtyInput = document.getElementById('qty-input');
    var selectedPriceEl = document.getElementById('selected-price');

    function updatePrice() {
      var qty = parseInt(qtyInput.value, 10) || 1;
      var pct = getDiscountPct(qty);
      if (pct > 0) {
        var discounted = basePrice * (1 - pct / 100);
        selectedPriceEl.innerHTML = '<del class="original-price">' + fmt(basePrice) + '</del> <span class="sale-price">' + fmt(discounted) + '</span>';
      } else {
        selectedPriceEl.textContent = fmt(basePrice);
      }
    }

    document.getElementById('qty-minus').addEventListener('click', function () {
      var v = parseInt(qtyInput.value, 10) || 1;
      if (v > 1) { qtyInput.value = v - 1; updatePrice(); }
    });
    document.getElementById('qty-plus').addEventListener('click', function () {
      var v = parseInt(qtyInput.value, 10) || 1;
      var max = parseInt(qtyInput.getAttribute('max'), 10);
      if (!max || v < max) { qtyInput.value = v + 1; updatePrice(); }
    });
    qtyInput.addEventListener('change', updatePrice);

    // Add to Cart
    document.getElementById('add-to-cart-btn').addEventListener('click', function () {
      var qty = parseInt(qtyInput.value, 10) || 1;
      var pct = getDiscountPct(qty);
      var unitPrice = pct > 0 ? basePrice * (1 - pct / 100) : basePrice;
      unitPrice = Math.round(unitPrice * 100) / 100;
      var ex = cart.find(function (i) { return i.id === product.sku; });
      if (ex) { ex.qty += qty; } else { cart.push({ id: product.sku, name: product.name, price: unitPrice, qty: qty, image: images[currentIdx] }); }
      saveCart();
      renderCart();
      window.location.href = '/cart/';
    });

    // Variation toggle & clear
    document.getElementById('variation-btn-1').addEventListener('click', function () {
      this.classList.add('active');
      document.getElementById('variation-selected').textContent = '5 Sheets of 20 (100 Stamps)';
    });
    document.getElementById('variation-clear').addEventListener('click', function () {
      document.querySelectorAll('.variation-btn').forEach(function (b) { b.classList.remove('active'); });
      document.getElementById('variation-selected').textContent = '';
    });

    // Tabs
    document.querySelectorAll('.tab-btn').forEach(function (btn) {
      btn.addEventListener('click', function () {
        var tab = this.getAttribute('data-tab');
        document.querySelectorAll('.tab-btn').forEach(function (b) { b.classList.remove('active'); });
        document.querySelectorAll('.tab-panel').forEach(function (p) { p.classList.remove('active'); });
        this.classList.add('active');
        var panel = document.getElementById('tab-' + tab);
        if (panel) panel.classList.add('active');
      });
    });

    // Discount table row click
    var discountRows = document.querySelectorAll('.discount-table tbody tr');
    discountRows.forEach(function (row) {
      row.addEventListener('click', function () {
        var qtyText = this.cells[0].textContent.trim();
        var match = qtyText.match(/(\d+)/);
        if (match) {
          var minQty = parseInt(match[1], 10);
          qtyInput.value = minQty;
          discountRows.forEach(function (r) { r.classList.remove('active-row'); });
          this.classList.add('active-row');
          updatePrice();
        }
      });
    });
  }

  function showNotFound() {
    document.title = 'Product Not Found ‚Äì Buy Discount Postage Online';
    var container = document.getElementById('product-page-content');
    container.innerHTML = '<div style="max-width:1200px;margin:60px auto;padding:0 15px;text-align:center;">' +
      '<h1 style="font-size:24px;color:#334862;margin-bottom:16px;">Product not found</h1>' +
      '<p style="color:#555;margin-bottom:24px;">The product you are looking for does not exist or may have been removed.</p>' +
      '<a href="../" style="color:#333365;font-weight:700;text-decoration:underline;">‚Üê Back to Home</a>' +
      '</div>';
  }

  function loadProduct() {
    var hash = window.location.hash.replace(/^#/, '');
    if (!hash) { showNotFound(); return; }

    // Try sessionStorage cache first for faster loads
    var cacheKey = 'yopao_products_cache';
    var cached = null;
    try { cached = JSON.parse(sessionStorage.getItem(cacheKey)); } catch(e) {}

    if (cached) {
      var product = cached.find(function (p) { return p.slug === hash; });
      if (product) { renderProduct(product, cached); return; }
    }

    // Fetch from PHP API (MySQL database) with fallback to static JSON
    fetch('/api/products.php?action=get&slug=' + encodeURIComponent(hash))
      .then(function (res) {
        if (!res.ok) throw new Error('API unavailable');
        return res.json();
      })
      .then(function (product) {
        if (product.error) { showNotFound(); return; }
        ensureLocalProductImages(product);
        // Also fetch all products for related products section
        return fetch('/api/products.php?action=list')
          .then(function (res) { return res.json(); })
          .then(function (allProducts) {
            allProducts.forEach(ensureLocalProductImages);
            try { sessionStorage.setItem(cacheKey, JSON.stringify(allProducts)); } catch(e) {}
            renderProduct(product, allProducts);
          });
      })
      .catch(function () {
        // Fallback: load from static JSON file if API is not available
        fetch('../products_data.json')
          .then(function (res) { return res.json(); })
          .then(function (allProducts) {
            allProducts.forEach(ensureLocalProductImages);
            try { sessionStorage.setItem(cacheKey, JSON.stringify(allProducts)); } catch(e) {}
            var product = allProducts.find(function (p) { return p.slug === hash; });
            if (!product) { showNotFound(); return; }
            renderProduct(product, allProducts);
          })
          .catch(function () { showNotFound(); });
      });
  }

  window.addEventListener('hashchange', function () { loadProduct(); });
  loadProduct();
}());
</script>

</body>
</html>
